<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulasi Penjumlahan Ceria</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --emoji-size: 44px; }
    body { font-family: 'Poppins', sans-serif; }
    .emoji { font-size: var(--emoji-size); line-height: 1; }
    .floaty { animation: floaty 3s ease-in-out infinite; }
    @keyframes floaty { 0%,100%{ transform: translateY(0) } 50%{ transform: translateY(-6px) } }
    .wiggle { animation: wiggle 0.5s ease-in-out; }
    @keyframes wiggle { 0%{ transform: rotate(0) } 25%{ transform: rotate(-6deg) } 75%{ transform: rotate(6deg) } 100%{ transform: rotate(0) } }
    .pop { animation: pop 320ms ease-out; }
    @keyframes pop { 0%{ transform: scale(0.7); opacity: 0 } 80%{ transform: scale(1.08); opacity: 1 } 100%{ transform: scale(1) } }
    .slide-in-up { animation: slideInUp 420ms cubic-bezier(.2,.8,.2,1); }
    @keyframes slideInUp { from{ transform: translateY(20px); opacity: 0 } to{ transform: translateY(0); opacity: 1 } }

    /* Confetti */
    .confetti-piece {
      position: absolute; width: 10px; height: 10px; border-radius: 2px; opacity: 0;
      animation: confetti 1200ms ease-out forwards;
    }
    @keyframes confetti {
      0% { transform: translateY(0) rotate(0); opacity: 0; }
      10% { opacity: 1; }
      100% { transform: translateY(140px) rotate(300deg); opacity: 0; }
    }

    /* Flying clone */
    .fly {
      position: absolute; pointer-events: none; will-change: transform, opacity;
      transition: transform 520ms cubic-bezier(.2,.9,.2,1), opacity 520ms ease;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));
    }

    .emoji-item { transition: transform 450ms cubic-bezier(.2,.9,.2,1), opacity 450ms ease; }

    @media (max-width: 640px) {
      :root { --emoji-size: 36px; }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-sky-500 via-indigo-500 to-fuchsia-500 text-white">
  <div class="max-w-5xl mx-auto p-6 sm:p-10">
    <!-- Header -->
    <header class="text-center mb-8">
      <div class="inline-flex items-center gap-3 bg-white/10 backdrop-blur px-5 py-2 rounded-full border border-white/20 shadow-lg slide-in-up">
        <span class="emoji">✨</span>
        <p class="text-sm">Belajar sambil bermain</p>
      </div>
      <h1 class="text-3xl sm:text-5xl font-extrabold mt-4 leading-tight drop-shadow-md">Simulasi Penjumlahan Ceria</h1>
      <p class="text-white/90 mt-2 text-base sm:text-lg">Atur jumlahnya, gabungkan, lalu hitung satu per satu!</p>
    </header>

    <!-- Controls -->
    <section class="bg-white/10 backdrop-blur rounded-2xl p-4 sm:p-6 border border-white/20 shadow-xl slide-in-up">
      <div class="flex flex-col lg:flex-row gap-4 lg:items-end">
        <div class="flex-1 grid grid-cols-2 sm:grid-cols-3 gap-3">
          <!-- Pilih emoji -->
          <div class="col-span-2 sm:col-span-1">
            <label class="block text-sm mb-1">Pilih gambar</label>
            <select id="themeSelect" class="w-full text-slate-900 rounded-xl px-3 py-2 outline-none">
              <option value="🍎">🍎 Apel</option>
              <option value="🌟">🌟 Bintang</option>
              <option value="🐟">🐟 Ikan</option>
              <option value="🧁">🧁 Kue</option>
              <option value="💎">💎 Permata</option>
              <option value="🌸">🌸 Bunga</option>
              <option value="🚗">🚗 Mobil</option>
              <option value="🎈">🎈 Balon</option>
            </select>
          </div>

          <!-- Kelompok A -->
          <div>
            <label class="block text-sm mb-1">Kelompok A</label>
            <div class="flex items-center bg-white/90 rounded-xl overflow-hidden shadow">
              <button id="decA" class="px-4 py-2 bg-slate-900 text-white hover:bg-slate-800 active:scale-95">−</button>
              <input id="countA" type="number" min="0" max="10" value="3" class="w-full text-center text-slate-900 font-semibold py-2 outline-none" />
              <button id="incA" class="px-4 py-2 bg-slate-900 text-white hover:bg-slate-800 active:scale-95">+</button>
            </div>
          </div>

          <!-- Kelompok B -->
          <div>
            <label class="block text-sm mb-1">Kelompok B</label>
            <div class="flex items-center bg-white/90 rounded-xl overflow-hidden shadow">
              <button id="decB" class="px-4 py-2 bg-slate-900 text-white hover:bg-slate-800 active:scale-95">−</button>
              <input id="countB" type="number" min="0" max="10" value="2" class="w-full text-center text-slate-900 font-semibold py-2 outline-none" />
              <button id="incB" class="px-4 py-2 bg-slate-900 text-white hover:bg-slate-800 active:scale-95">+</button>
            </div>
          </div>
        </div>

        <!-- Tombol aksi -->
        <div class="flex flex-wrap gap-2">
          <button id="randomBtn" class="px-4 py-2 rounded-xl bg-amber-400 text-slate-900 font-semibold hover:bg-amber-300 active:scale-95 shadow">Acak</button>
          <button id="combineBtn" class="px-4 py-2 rounded-xl bg-emerald-400 text-slate-900 font-semibold hover:bg-emerald-300 active:scale-95 shadow">Gabungkan</button>
          <button id="showBtn" class="px-4 py-2 rounded-xl bg-cyan-400 text-slate-900 font-semibold hover:bg-cyan-300 active:scale-95 shadow">Tampilkan Hasil</button>
          <button id="resetBtn" class="px-4 py-2 rounded-xl bg-white/20 font-semibold hover:bg-white/30 active:scale-95 shadow">Reset</button>
        </div>
      </div>
    </section>

    <!-- Playground -->
    <section class="mt-6 space-y-6">
      <!-- Kelompok A & B -->
      <div id="groupsCard" class="bg-white/10 backdrop-blur rounded-2xl p-5 border border-white/20 shadow-xl relative overflow-hidden">
        <div class="flex items-center justify-center gap-4 mb-4">
          <span class="text-lg bg-white/10 px-3 py-1 rounded-full border border-white/20">A + B</span>
        </div>

        <div id="groupsContainer" class="transition-all">
          <div class="flex flex-col sm:flex-row items-stretch sm:items-start justify-center gap-6">
            <!-- A -->
            <div class="group-a flex-1 bg-white/5 rounded-xl border border-white/10 p-4">
              <div class="flex items-center justify-between mb-2">
                <h3 class="font-semibold">Kelompok A</h3>
                <span id="labelA" class="text-white/80 text-sm">3</span>
              </div>
              <div id="areaA" class="min-h-[72px] flex flex-wrap gap-2"></div>
            </div>
            <!-- tanda + -->
            <div class="hidden sm:flex items-center justify-center">
              <div class="w-12 h-12 rounded-full bg-white/15 border border-white/20 flex items-center justify-center text-2xl">+</div>
            </div>
            <!-- B -->
            <div class="group-b flex-1 bg-white/5 rounded-xl border border-white/10 p-4">
              <div class="flex items-center justify-between mb-2">
                <h3 class="font-semibold">Kelompok B</h3>
                <span id="labelB" class="text-white/80 text-sm">2</span>
              </div>
              <div id="areaB" class="min-h-[72px] flex flex-wrap gap-2"></div>
            </div>
          </div>
        </div>

        <!-- Persamaan -->
        <div class="text-center mt-6">
          <div class="inline-block bg-white/10 px-4 py-2 rounded-full border border-white/20 text-lg">
            <span id="eqA">3</span> + <span id="eqB">2</span> = <span id="eqQ" class="text-white/70">?</span>
          </div>
        </div>

        <!-- Layers -->
        <div id="flyLayer" class="pointer-events-none absolute inset-0"></div>
        <div id="confetti" class="pointer-events-none absolute inset-0"></div>
      </div>

      <!-- Hasil -->
      <div id="resultCard" class="bg-white/10 backdrop-blur rounded-2xl p-5 border border-white/20 shadow-xl hidden">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold">Hasil</h3>
          <div class="flex items-center gap-2">
            <button id="countOneByOne" class="px-3 py-1 rounded-lg bg-amber-300 text-slate-900 font-semibold hover:bg-amber-200 active:scale-95">Hitung Satu per Satu</button>
          </div>
        </div>

        <!-- Grid hasil -->
        <div id="resultRow" class="min-h-[72px] grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>

        <!-- Jawaban interaktif -->
        <div class="mt-6 bg-white/10 rounded-xl p-4 border border-white/20">
          <p class="text-sm text-white/90 mb-2">Tebak totalnya di sini:</p>
          <div class="flex items-center gap-3 flex-wrap">
            <input id="answerInput" type="number" min="0" class="px-4 py-2 rounded-xl text-slate-900 font-semibold outline-none" placeholder="Tulis angka"/>
            <button id="submitAnswer" class="px-4 py-2 rounded-xl bg-emerald-400 text-slate-900 font-semibold hover:bg-emerald-300 active:scale-95">Kirim Jawaban</button>
            <button id="revealAnswer" class="px-4 py-2 rounded-xl bg-cyan-400 text-slate-900 font-semibold hover:bg-cyan-300 active:scale-95">Lihat Jawaban</button>
            <span id="answerMsg" class="ml-2"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer tip -->
    <footer class="text-center text-white/80 mt-8">
      <p>Tip: Setelah menekan Tampilkan Hasil, ketuk tiap gambar untuk melihat angkanya, atau pakai “Hitung Satu per Satu”.</p>
    </footer>
  </div>

  <script>
    // State
    const state = {
      emoji: "🍎",
      a: 3,
      b: 2,
      combining: false,
      shown: false,
      counting: false
    };

    // Elements
    const themeSelect = document.getElementById('themeSelect');
    const countA = document.getElementById('countA');
    const countB = document.getElementById('countB');
    const incA = document.getElementById('incA');
    const decA = document.getElementById('decA');
    const incB = document.getElementById('incB');
    const decB = document.getElementById('decB');

    const labelA = document.getElementById('labelA');
    const labelB = document.getElementById('labelB');
    const eqA = document.getElementById('eqA');
    const eqB = document.getElementById('eqB');
    const eqQ = document.getElementById('eqQ');

    const areaA = document.getElementById('areaA');
    const areaB = document.getElementById('areaB');
    const groupsContainer = document.getElementById('groupsContainer');

    const groupsCard = document.getElementById('groupsCard');
    const flyLayer = document.getElementById('flyLayer');
    const confettiLayer = document.getElementById('confetti');

    const resultCard = document.getElementById('resultCard');
    const resultRow = document.getElementById('resultRow');

    const randomBtn = document.getElementById('randomBtn');
    const combineBtn = document.getElementById('combineBtn');
    const showBtn = document.getElementById('showBtn');
    const resetBtn = document.getElementById('resetBtn');
    const countOneByOneBtn = document.getElementById('countOneByOne');

    const answerInput = document.getElementById('answerInput');
    const submitAnswer = document.getElementById('submitAnswer');
    const revealAnswer = document.getElementById('revealAnswer');
    const answerMsg = document.getElementById('answerMsg');

    // Helpers
    const clamp = (n, min, max) => Math.max(min, Math.min(max, n));

    function makeEmojiItem(char) {
      const span = document.createElement('span');
      span.className = 'emoji-item emoji floaty';
      span.textContent = char;
      span.style.transitionDelay = (Math.random() * 0.12) + 's';
      return span;
    }

    function setCounts(a, b) {
      state.a = clamp(a, 0, 10);
      state.b = clamp(b, 0, 10);
      countA.value = state.a;
      countB.value = state.b;
      state.shown = false;
      resultCard.classList.add('hidden');
      eqQ.textContent = '?';
      renderGroups();
    }

    function renderGroups() {
      labelA.textContent = state.a;
      labelB.textContent = state.b;
      eqA.textContent = state.a;
      eqB.textContent = state.b;

      areaA.innerHTML = '';
      areaB.innerHTML = '';
      for (let i = 0; i < state.a; i++) areaA.appendChild(makeEmojiItem(state.emoji));
      for (let i = 0; i < state.b; i++) areaB.appendChild(makeEmojiItem(state.emoji));

      groupsContainer.classList.remove('combining');
    }

    function buildResultItem(index, emojiChar) {
      const wrapper = document.createElement('div');
      wrapper.className = 'bg-white/10 border border-white/20 rounded-xl p-3 flex flex-col items-center justify-center gap-2 hover:bg-white/15 cursor-pointer select-none';

      const face = document.createElement('div');
      face.className = 'emoji pop';
      face.textContent = emojiChar;

      const label = document.createElement('span');
      label.textContent = index.toString();
      label.className = 'text-sm px-2 py-0.5 rounded-full bg-sky-300/80 text-slate-900 font-bold shadow';
      label.style.opacity = 0;

      wrapper.addEventListener('click', () => {
        label.style.opacity = 1;
        wrapper.classList.add('pop');
        setTimeout(() => wrapper.classList.remove('pop'), 320);
      });

      wrapper.appendChild(face);
      wrapper.appendChild(label);
      return wrapper;
    }

    function renderResult(withPop = true) {
      const total = state.a + state.b;
      resultRow.innerHTML = '';
      for (let i = 1; i <= total; i++) {
        const item = buildResultItem(i, state.emoji);
        if (!withPop) item.classList.remove('pop');
        resultRow.appendChild(item);
      }
    }

    function celebrate() {
      confettiLayer.innerHTML = '';
      const colors = ['#FDE047', '#34D399', '#60A5FA', '#F472B6', '#F97316', '#22D3EE', '#A78BFA'];
      const rect = confettiLayer.getBoundingClientRect();
      const count = 26;
      for (let i = 0; i < count; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.left = (Math.random() * rect.width) + 'px';
        piece.style.top = (Math.random() * 40 + 10) + 'px';
        piece.style.background = colors[i % colors.length];
        piece.style.transform = `translateY(0) rotate(${Math.random() * 90}deg)`;
        piece.style.animationDelay = (Math.random() * 200) + 'ms';
        confettiLayer.appendChild(piece);
      }
      setTimeout(() => { confettiLayer.innerHTML = ''; }, 1600);
    }

    // Gabungkan: geser menyatu (semua item B meluncur ke A, lalu buka Hasil)
    function combineSlideMerge() {
      if (state.combining) return;
      const items = Array.from(areaB.children);
      if (!items.length) {
        // Tidak ada yang dipindahkan, langsung tampilkan hasil
        state.shown = true;
        resultCard.classList.remove('hidden');
        renderResult(true);
        return;
      }
      state.combining = true;
      combineBtn.disabled = true;
      combineBtn.classList.add('opacity-60');

      const cardRect = groupsCard.getBoundingClientRect();
      const targetRect = areaA.getBoundingClientRect();
      const targetX = targetRect.left - cardRect.left + targetRect.width / 2;
      const targetY = targetRect.top - cardRect.top + targetRect.height / 2;

      items.forEach((orig, i) => {
        const r = orig.getBoundingClientRect();
        const startX = r.left - cardRect.left + r.width / 2;
        const startY = r.top - cardRect.top + r.height / 2;

        // Sembunyikan aslinya saat terbang
        setTimeout(() => { orig.style.opacity = 0; }, i * 120);

        // Buat klon terbang
        const flyer = document.createElement('div');
        flyer.className = 'fly emoji';
        flyer.textContent = state.emoji;
        flyer.style.left = (startX - 22) + 'px'; // offset kecil agar center
        flyer.style.top = (startY - 22) + 'px';
        flyLayer.appendChild(flyer);

        // Trigger animasi setelah reflow
        setTimeout(() => {
          const dx = targetX - startX + (Math.random()*20 - 10); // sedikit variasi
          const dy = targetY - startY + (Math.random()*12 - 6);
          flyer.style.transform = `translate(${dx}px, ${dy}px) scale(0.95)`;
          flyer.style.opacity = 0.9;
        }, 20 + i * 120);

        // Setelah selesai terbang, hapus klon
        setTimeout(() => {
          flyer.remove();
          // Pada item terakhir, selesaikan gabungan
          if (i === items.length - 1) {
            // Perbarui state: semua dari B berpindah ke A
            state.a = clamp(state.a + items.length, 0, 20);
            state.b = 0;
            renderGroups();
            labelA.textContent = state.a;
            labelB.textContent = '0';
            eqA.textContent = state.a;
            eqB.textContent = '0';

            // Tampilkan hasil otomatis
            state.shown = true;
            resultCard.classList.remove('hidden');
            resultCard.classList.add('slide-in-up');
            setTimeout(() => resultCard.classList.remove('slide-in-up'), 420);
            renderResult(true);
            // Pastikan angka di bawah gambar tersembunyi dulu
            setTimeout(() => {
              document.querySelectorAll('#resultRow > div > span:last-child').forEach(l => l.style.opacity = 0);
            }, 30);

            // Selesai
            state.combining = false;
            combineBtn.disabled = false;
            combineBtn.classList.remove('opacity-60');
          }
        }, 700 + i * 120);
      });
    }

    // Events
    themeSelect.addEventListener('change', () => {
      state.emoji = themeSelect.value;
      renderGroups();
      if (state.shown) renderResult(false);
    });

    // Tombol +/-
    incA.addEventListener('click', () => setCounts(state.a + 1, state.b));
    decA.addEventListener('click', () => setCounts(state.a - 1, state.b));
    incB.addEventListener('click', () => setCounts(state.a, state.b + 1));
    decB.addEventListener('click', () => setCounts(state.a, state.b - 1));

    // Input manual
    countA.addEventListener('input', () => setCounts(parseInt(countA.value || 0, 10), state.b));
    countB.addEventListener('input', () => setCounts(state.a, parseInt(countB.value || 0, 10)));

    randomBtn.addEventListener('click', () => {
      const a = Math.floor(Math.random() * 11);
      const b = Math.floor(Math.random() * 11);
      setCounts(a, b);
      eqQ.classList.add('slide-in-up');
      setTimeout(() => eqQ.classList.remove('slide-in-up'), 420);
    });

    combineBtn.addEventListener('click', combineSlideMerge);

    showBtn.addEventListener('click', () => {
      state.shown = true;
      renderGroups();
      resultCard.classList.remove('hidden');
      resultCard.classList.add('slide-in-up');
      setTimeout(() => resultCard.classList.remove('slide-in-up'), 420);
      renderResult(true);
      setTimeout(() => {
        document.querySelectorAll('#resultRow > div > span:last-child').forEach(l => l.style.opacity = 0);
      }, 30);
    });

    resetBtn.addEventListener('click', () => {
      state.emoji = '🍎';
      themeSelect.value = state.emoji;
      setCounts(3, 2);
    });

    // Hitung satu per satu (otomatis)
    countOneByOneBtn.addEventListener('click', () => {
      if (state.counting) return;
      const items = Array.from(resultRow.children);
      if (!items.length) return;

      state.counting = true;
      countOneByOneBtn.disabled = true;
      countOneByOneBtn.classList.add('opacity-60');

      // reset semua label ke tersembunyi dulu
      items.forEach(el => {
        const label = el.querySelector('span:last-child');
        if (label) label.style.opacity = 0;
      });

      items.forEach((el, i) => {
        setTimeout(() => {
          const label = el.querySelector('span:last-child');
          if (label) label.style.opacity = 1;
          el.classList.add('pop');
          setTimeout(() => el.classList.remove('pop'), 320);
          if (i === items.length - 1) {
            state.counting = false;
            countOneByOneBtn.disabled = false;
            countOneByOneBtn.classList.remove('opacity-60');
            celebrate();
          }
        }, i * 350);
      });
    });

    // Jawaban interaktif
    function setAnswerMsg(text, ok = false) {
      answerMsg.textContent = text;
      answerMsg.className = ok ? 'text-emerald-200 font-semibold' : 'text-rose-200 font-semibold';
    }

    submitAnswer.addEventListener('click', () => {
      const val = parseInt((answerInput.value || '').trim(), 10);
      const total = state.a + state.b;
      if (isNaN(val)) {
        setAnswerMsg('Isi dulu angkanya ya!');
        return;
      }
      if (val === total) {
        setAnswerMsg('Betul! 🎉', true);
        celebrate();
      } else {
        setAnswerMsg('Belum tepat. Coba hitung lagi.');
      }
    });

    revealAnswer.addEventListener('click', () => {
      const total = state.a + state.b;
      answerInput.value = total;
      setAnswerMsg('Ini jawabannya. Mantap! ✅', true);
    });

    // Init
    function init() {
      renderGroups();
      resultCard.classList.add('hidden');
    }
    init();
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97124c9f71b6b5b4',t:'MTc1NTUyOTQyMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
